# 地图位置共享应用实现计划

## 项目结构

```
MapLocationShare/
├── backend/
│   ├── main.go              # Go后端入口
│   ├── websocket/           # WebSocket处理
│   ├── handlers/            # HTTP处理器
│   ├── models/              # 数据模型
│   ├── storage/             # Redis存储
│   └── go.mod
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── Map.jsx      # 地图组件
│   │   │   └── ShareButton.jsx
│   │   ├── services/
│   │   │   ├── api.js       # API调用
│   │   │   └── websocket.js # WebSocket连接
│   │   ├── App.jsx
│   │   └── index.js
│   ├── package.json
│   └── public/
└── README.md
```

## 技术选型

* **地图服务**：高德地图（免费额度高，API友好）

* **实时通信**：WebSocket（双向通信，实时性高）

* **数据库**：Redis（内存数据库，支持过期机制，适合实时位置存储）

* **后端框架**：Gin（轻量级Go Web框架）

* **前端框架**：React

## 核心功能实现

### 1. 后端实现

* 初始化Gin服务器和Redis连接

* 实现WebSocket处理器，支持多用户位置广播

* 实现HTTP API：

  * POST /api/session - 创建分享会话

  * GET /api/session/:id - 获取会话信息

  * POST /api/location - 上报用户位置

* 位置更新通过WebSocket广播给同一会话的所有用户

### 2. 前端实现

* 集成高德地图API，显示用户位置

* 使用浏览器Geolocation API获取当前位置

* 实现分享按钮，生成分享链接

* 建立WebSocket连接，实时接收和发送位置更新

* 支持多用户位置同时显示在地图上

### 3. 数据存储（Redis）

* session:{sessionId} - 存储会话信息（创建时间、过期时间）

* session:{sessionId}:locations - 存储该会话下所有用户的位置

* 设置TTL为24小时，自动清理过期数据

## 实现步骤

1. 初始化项目结构，创建Go模块和React应用
2. 配置后端依赖（Gin、WebSocket、Redis）
3. 实现后端WebSocket处理器和HTTP API
4. 配置前端依赖，创建地图组件
5. 实现位置获取和分享功能
6. 实现WebSocket实时通信
7. 测试多用户位置共享功能
8. 添加错误处理和优化

